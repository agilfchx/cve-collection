# CVE-2024-43243
## Arbitrary File Upload [Unauthenticated]
### Vulnerable Code

The vulnerable code is located in the file `job-board-light/plugin.php`, specifically in the *`user_profile_image_upload`* function (Line 644):

```php
public function user_profile_image_upload($userid){
				$iv_membership_signup_profile_pic=get_option('jobboard_signup_profile_pic');
				<-- CUT -->
					else {  
						 $new_file_type = mime_content_type( $_FILES['profilepicture']['tmp_name'] );	
						
						if( in_array( $new_file_type, get_allowed_mime_types() ) ){   
							$upload_dir   = wp_upload_dir();
							$date = date('YmdHis');						
							$file_name = $date.sanitize_file_name($_FILES['profilepicture']['name']);
							$return= move_uploaded_file($_FILES['profilepicture']['tmp_name'],  $upload_dir['basedir'].'/'.$file_name);
							if($return){  
								$image_url= $upload_dir['baseurl'].'/'.$file_name;
				<-- CUT -->
```

As we can see in line 655, there is condition to check is whether `$new_file_type` variable contains a mime type that is allowed in the `get_allowed_mime_types()` function. The check is only limited to that (no more validation) and we can bypass it by adding magic bytes, for example GIF, which is `GIF89a;` and we can bypass this upload file.

For the filename we actually can brute force it since using timestamp

To run this script
```
python3 .\sage-ai-poc.py <TARGET>
```