# CVE-2024-56013
## Account Take Over [Subscriber+]
### Vulnerable Code
The vulnerable code located at `wovax-idx/wovax-idx-ajax.php`

```php
add_action('wp_ajax_update_profile', 'wovax_idx_update_profile'); [1]
...
function wovax_idx_update_profile() {
  $id              = filter_var($_POST['id'], FILTER_SANITIZE_STRING) ? filter_var($_POST['id'], FILTER_SANITIZE_STRING):''; [2]
  $firstname       = filter_var($_POST['firstname'], FILTER_SANITIZE_STRING) ? filter_var($_POST['firstname'], FILTER_SANITIZE_STRING):'';
  $lastname        = filter_var($_POST['lastname'], FILTER_SANITIZE_STRING) ? filter_var($_POST['lastname'], FILTER_SANITIZE_STRING):'';
  $email           = filter_var($_POST['email'], FILTER_SANITIZE_STRING) ? filter_var($_POST['email'], FILTER_SANITIZE_STRING):'';
  $password        = filter_var($_POST['password'], FILTER_SANITIZE_STRING) ? filter_var($_POST['password'], FILTER_SANITIZE_STRING):'';
  $verify_password = filter_var($_POST['verify_password'], FILTER_SANITIZE_STRING) ? filter_var($_POST['verify_password'], FILTER_SANITIZE_STRING):'';
  $phone           = filter_var($_POST['phone'], FILTER_SANITIZE_STRING) ? filter_var($_POST['phone'], FILTER_SANITIZE_STRING):'';
  $username        = filter_var($_POST['username'], FILTER_SANITIZE_STRING) ? filter_var($_POST['username'], FILTER_SANITIZE_STRING):'';

  $update_values = array( 'ID' => $id); [3]
  if($firstname != null && $firstname != ''){$update_values['first_name'] = $firstname;}
  if($lastname != null && $lastname != ''){$update_values['last_name'] = $lastname;}
  if($email != null && $email != ''){$update_values['user_email'] = $email;}
  if($password != null && $password != '' && $verify_password != null && $verify_password != '' && $password == $verify_password){$update_values['user_pass'] = $password;} [4]
  if($username != null && $username != ''){$update_values['user_login'] = $username;}

  if($phone != null && $phone != ''){update_user_meta($id, 'phone', $phone);}

  $update_user = wp_update_user( $update_values ); [5]

  if ( is_wp_error( $update_user ) ) {
    $result = 'There was an error';
  } else {
    $result = 'Success!';
  }

  echo json_encode(array(
    'value' => $result
  ));

  exit();
}
```

In section [1], we can see that the `wovax_idx_update_profile` function can be called using AJAX. In section [2], we can see that this `ID` can be controlled by the user. Then, in section [3], it will look for a valid `ID` from the previous user input in section [2]. In section [4], it only checks whether the password inputted before and after matches, not the old password. Finally, in section [5], the data that has been inputted will be updated by `wp_update_user`.


To run this script
```
python3 .\wovax-idx-ato-poc.py -t <TARGET> -u <UNAME-SUBSCRIBER> -p <PASS-SUBSCRIBER>
```