# CVE-2024-50504
## Privilege Escalation [Subscriber+]
### Vulnerable Code

The vulnerable code located at `bulk-role-change/include/ajax.php`

```php
add_action( 'wp_ajax_bulk_change_role', 'bulk_change_role_callback' );
function bulk_change_role_callback() {
	global $wpdb; // this is how you get access to the database
	$current_role 	= trim( $_POST['current_role'] );
	$new_role 		= trim( $_POST['new_role'] );
	$users_by_role 	= get_users( array( 'role' => $current_role ) ); // https://codex.wordpress.org/Function_Reference/get_users
	$output = null;
	foreach ( $users_by_role as $user ) {
		$output .= esc_html( $user->ID ) . ',';
        $u = new WP_User( $user->ID );
        $u->remove_role( $current_role );
        $u->add_role( $new_role );
	}
	echo $output;
	wp_die(); // this is required to terminate immediately and return a proper response
}
```

From the provided code, it can be concluded that the `bulk_change_role_callback` function can be invoked via AJAX. This function lacks access control, meaning that any user, including those with the "subscriber" role, can potentially change their role or the roles of other users.

To run this script
```
python3 .\bulk-change-role-poc.py -t <TARGET> -u <UNAME-SUBSCRIBER> -p <PASS-SUBSCRIBER>
```